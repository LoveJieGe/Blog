@model HxBlogs.WebApp.Models.RegisterViewModel
@{
    ViewBag.Title = "注册";
}

<div class="content">
    @using (Ajax.BeginForm("registeruser", "account", new { }, 
        new AjaxOptions()
    {
        OnBegin="beforeRegister",
        HttpMethod = "post",
        OnSuccess="afterRegister",
        OnComplete="finishRegister"
    }, new
    {
        @class = "form-vertical register-form",
        role = "form",
        id = "registerForm"
    }))
    {
        <h3 class="form-title">用户注册</h3>
        <input type="hidden"  name="ReturnUrl" value="@ViewBag.ReturnUrl"/>
        <div class="control-group">
            <!--ie8, ie9 does not support html5 placeholder, so we just show field title for that-->
            <label class="control-label visible-ie8 visible-ie9">用户名</label>
            <div class="controls">
                <div class="input-icon left">
                    <i class="fa fa-user"></i>
                    @Html.TextBoxFor(m => m.UserName, new{@class = "m-wrap placeholder-no-fix",placeholder = "用户名"})
                    @*<input class="m-wrap placeholder-no-fix" type="text" placeholder="用户名" name="@Html.NameFor(m=>m.UserName)" />*@
                </div>
                @Html.ValidationMessageFor(m => m.UserName)
            </div>
        </div>
        <div class="control-group">
            <label class="control-label visible-ie8 visible-ie9">邮箱</label>
            <div class="controls">
                <div class="input-icon left">
                    <i class="fa fa-envelope"></i>
                    @Html.TextBoxFor(m => m.Email, new{@class = "m-wrap placeholder-no-fix",placeholder = "邮箱"})
                    @*<input class="m-wrap placeholder-no-fix" type="text" placeholder="邮箱" name="@Html.NameFor(m =>m.Email)" />*@
                </div>
                @Html.ValidationMessageFor(m => m.Email)
            </div>
        </div>
        <div class="control-group">
            <label class="control-label visible-ie8 visible-ie9">密码</label>
            <div class="controls">
                <div class="input-icon left">
                    <i class="fa fa-lock"></i>
                    @Html.PasswordFor(m => m.PassWord, new{@class = "m-wrap placeholder-no-fix",placeholder = "密码"})
                    @*<input class="m-wrap placeholder-no-fix" type="password" placeholder="密码" name="@Html.NameFor(m =>m.PassWord)" />*@
                </div>
                @Html.ValidationMessageFor(m => m.PassWord)
            </div>
        </div>
        <div class="control-group">
            <label class="control-label visible-ie8 visible-ie9">确认密码</label>
            <div class="controls">
                <div class="input-icon left">
                    <i class="fa fa-lock"></i>
                    @Html.PasswordFor(m => m.PwdConfirm, new{@class = "m-wrap placeholder-no-fix",placeholder = "确认密码"})
                    @*<input class="m-wrap placeholder-no-fix" type="password" placeholder="确认密码" name="@Html.NameFor(m =>m.PassWord)" />*@
                </div>
                @Html.ValidationMessageFor(m => m.PwdConfirm)
            </div>
        </div>
        <div class="form-actions">
            <input type="submit" class="btn btn-register" id="btnReg" value="注册" />
            @*<button id="btnReg" type="button" class="btn">注册</button>*@
        </div>
    }
</div>
@section scripts{
   <script type="text/javascript">
       //如果按钮时禁用状态，禁止提交
       function beforeRegister() {
           var btnReg = $('#btnReg');
           if (btnReg.hasClass('disabled')) {
               return false;
           }
           btnReg.addClass('disabled');
       }
       function afterRegister(data) {
           if (data.IsSuccess) {
               alert(`注册成功!${data.Message}`);
               window.location.href = data.ReturnUrl && decodeURIComponent(data.ReturnUrl) || "/";
           } else {
               var html = `<div id="myAlert" class="alert alert-warning">
        <a href="#" class="close" data-dismiss="alert"></a>
        <strong>注册失败！</strong>${data.Message}
    </div>`;
               var myAlert = $(html);
               myAlert.appendTo('.content');
               window.setTimeout(function () {
                   myAlert.alert('close');
               }, 3000);
           }
       }
       //修改按钮状态为可用
       function finishRegister() {
           var btnReg = $('#btnReg');
           if (btnReg.hasClass('disabled')) {
               btnReg.removeClass('disabled');
           }
       }
    </script>
}
